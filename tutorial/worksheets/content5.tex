\section*{NAIL062 P\&P Logic: Worksheet 5 -- The resolution method}
% after Lecture 5


\subsection*{Teaching goals:} After completing, the student

    \begin{itemize}\setlength{\itemsep}{0pt}
        \item knows the necessary concepts of the resolution method (resolution rule, resolvent, resolution proof/refutation, resolution tree), can formally define them and provide examples
        \item can work with formulas in CNF and their models in set representation
        \item can construct a resolution refutation of a given (even infinite) CNF formula (if it exists), and also draw the corresponding resolution tree
        \item knows the notion of a substitution tree, can formally define it and construct it for a concrete CNF formula
        \item can apply the resolution method to solve a given problem (word problem, etc.)
    \end{itemize}
    

\section*{In-class problems}


\begin{problem}

    Let $\varphi$ denote the formula $\neg (p \vee q) \to (\neg p \wedge \neg q)$. Show that $\varphi$ is a tautology:
    \begin{enumerate}[(a)]
        \item Convert $\neg \varphi$ to CNF and write the resulting formula as $S$ in set representation.
        \item Find a resolution refutation of $S$.
    \end{enumerate}

    \begin{solution}

        \begin{enumerate}[(a)]
            \item Using equivalent transformations: $\neg\varphi=\neg(\neg (p \vee q) \to (\neg p \wedge \neg q))\sim\neg(\neg \neg (p \vee q) \lor (\neg p \wedge \neg q))\sim\neg(p \vee q \vee (\neg p \wedge \neg q))\sim \neg p \land \neg q \land  \neg (\neg p \wedge \neg q)\sim\neg p \land \neg q \land  (p \lor q)$
            $$
            S = \{\{\neg p\},\{\neg q\},\{p,q\}\}
            $$
            \item Resolution refutation: $\{\neg p\},\{p,q\},\{q\},\{\neg q\},\square$ (draw the corresponding resolution tree).
        \end{enumerate}
                    
    \end{solution}

\end{problem}


\begin{problem}

    Prove by resolution that in $T=\{\neg p \to \neg q,\neg q \to \neg r, (r\to p)\to s\}$ the statement $s$ holds.

    \begin{solution}
        Convert the theory $T\cup\{\neg s\}$ to CNF and write it in set representation. We have $(r\to p)\to s\sim \neg(\neg r\lor p)\lor s\sim (r\land\neg p)\lor s\sim (r\lor s)\land (\neg p\lor s)$; the other axioms convert easily. We obtain $S=\{\{p,\neg q\},\{q,\neg r\},\{r,s\},\{\neg p,s\},\{\neg s\}\}$. We depict the resolution refutation by a resolution tree:

        \begin{center}
            \begin{forest}
            for tree={grow=north}
            [$ \square $
                [$ \{\neg q\} $
                    [{$ \{p, \neg q\} $}]   
                    [{$ \{\neg p\} $}
                        [{$ \{\neg s\} $}]
                        [{$ \{\neg p, s\} $}]
                    ]
                ]
                [$ \{q\} $
                    [{$ \{q, \neg r\} $}]
                    [{$ \{r\} $}
                        [{$ \{\neg s\} $}]
                        [{$ \{r, s\} $}]
                    ]
                ]
            ]
            \end{forest}
        \end{center}
                    
    \end{solution}

\end{problem}


\begin{problem}
    
    Let the propositional variables $r$, $s$, $t$ represent (respectively) that \emph{``Radka / Sára / Tom is at school''} and write $\mathbb{P}=\{r,s,t\}$. We know that:
    \begin{itemize}\it
        \item If Tom is not at school, then Sára is not there either.
        \item Radka does not go to school without Sára.
        \item If Radka is not at school, then Tom is there.
    \end{itemize}
    \begin{enumerate}[(a)]
        \item Formalize our knowledge as a theory $T$ in the language $\mathbb P$.
        \item Using the resolution method, prove that $T$ entails that \emph{Tom is at school}: Write a formula $S$ in set representation that is unsatisfiable exactly when this holds, and find a resolution refutation of $S$. Draw the resolution tree.
        \item Determine the set of models of the theory $T$.
    \end{enumerate}

    \begin{solution}

        \begin{enumerate}[(a)]
            \item $T=\{\neg t\limplies\neg s, \neg(r\land\neg s), \neg r\limplies t\}$
            \item We obtain $S$ from the theory $T\cup\{\neg t\}$ by converting to CNF: $S=\{\{t,\neg s\},\{\neg r,s\},\{r,t\},\{\neg t\}\}$
            \begin{center}
                \begin{forest}
                for tree={grow=north}
                [$ \square $
                    [{$ \{\neg s\} $}
                        [{$ \{\neg t\} $}]
                        [{$ \{t, \neg s\} $}]
                    ]
                    [$ \{s\} $
                        [{$ \{\neg r, s\} $}]
                        [{$ \{r\} $}
                            [{$ \{\neg t\} $}]
                            [{$ \{r, t\} $}]
                        ]
                    ]
                ]
                \end{forest}
            \end{center}
            \item We use that $T\models t$ (proved in (b)). Because of this, the first and third axioms are satisfied, $T\sim\{t,\neg(r\land\neg s)\}$. From this it follows easily that $\M(T)=\{(0,0,1),(0,1,1),(1,1,1)\}$.            
        \end{enumerate}
                    
    \end{solution}

\end{problem}


\begin{problem}
        
    Construct a \emph{substitution tree} for the following formula. Based on this tree, construct a resolution refutation according to the procedure from the proof of the Completeness Theorem for resolution.
    $$
    S=\{\{p,r\},\{q,\neg r\},\{\neg q\},\{\neg p,t\},\{\neg s\},\{s,\neg t\}\}
    $$

    \begin{solution}
        We branch preferentially on propositional variables in unit clauses. (Once we encounter the empty clause, we know the branch is contradictory; we do not need the rest of the formula; here, due to lack of space, we will not write it.)
        \begin{center}
            \begin{forest}    
            [{$S$}
                [{$S^q=\{\{p,r\},\square,\dots\}$}, tikz={\node[fit to=tree,label=below:{$\otimes$}] {};}] 
                [{$S^{\bar q}=\{\{p,r\},\{\neg r\},\{\neg p,t\},\{\neg s\},\{s,\neg t\}\}$}
                    [{$S^{\bar qr}=\{\square,\dots\}$}, tikz={\node[fit to=tree,label=below:{$\otimes$}] {};}] 
                    [{$S^{\bar q\bar r}=\{\{p\},\{\neg p,t\},\{\neg s\},\{s,\neg t\}\}$}
                        [{$S^{\bar q \bar r p}=\{\{t\},\{\neg s\},\{s,\neg t\}\}$}
                            [{$S^{\bar q \bar r p s}=\{\{t\},\square\}$}, tikz={\node[fit to=tree,label=below:{$\otimes$}] {};}] 
                            [{$S^{\bar q \bar r p \bar s}=\{\{t\},\{\neg t\}\}$}
                               [{$S^{\bar q \bar r p \bar s t}=\{\square\}$}, tikz={\node[fit to=tree,label=below:{$\otimes$}] {};}] 
                               [{$S^{\bar q \bar r p \bar s \bar t}=\{\square\}$}, tikz={\node[fit to=tree,label=below:{$\otimes$}] {};}]                                 
                            ]
                        ]
                        [{$S^{\bar q \bar r \bar p}=\{\square,\dots\}$}, tikz={\node[fit to=tree,label=below:{$\otimes$}] {};}] 
                    ]
                ]
            ]
            \end{forest}
        \end{center}
        The substitution tree provides a “recipe” for constructing a resolution refutation (which is key to the proof of the completeness theorem for resolution). We proceed from leaves to root, i.e., by the number of variables in the formulas. For the formulas at the leaves of the substitution tree we have one-element resolution refutations $\square$.

        The formula $S^{\bar q \bar r p \bar s}=\{\{t\},\{\neg t\}\}$ has a one-step resolution refutation:

        \begin{center}
            \begin{forest}    
            [{$\square$}
                [{$\{\neg t\}$}]
                [{$\{t\}$}]
            ]
            \end{forest}
        \end{center}

        How was this obtained? From the resolution refutation $\square$ of the formula $S^{\bar q \bar r p \bar s t}$ we produce a resolution proof of the clause $\{\neg t\}$ from $S^{\bar q \bar r p \bar s}$ by, for each leaf that arose by deleting the literal $\neg t$, putting $\neg t$ back into it and into all clauses above it. (Here we have only one leaf, which is also the root $\square$.)

        Analogously, we produce a resolution proof of $\{t\}$ from $S^{\bar q \bar r p \bar s \bar t}$ (we add the literal $t$ to the nodes). And finally we add one resolution step that derives $\square$ from $\{\neg t\}$ and $\{t\}$. (If no leaf arose by deleting a literal from a clause of $S^{\bar q \bar r p \bar s}$, it means that the resolution refutation we have is already a resolution refutation of $S^{\bar q \bar r p \bar s}$ as well.)

        We proceed in the same way higher in the tree, for $S^{\bar q \bar r p}$, $S^{\bar q \bar r}$, $S^{\bar q}$, and finally for $S$:

            \begin{forest}    
                [{$\square$}
                    [{$\{\neg s\}$}]
                    [{$\{s\}$}
                        [{$\{\neg t,s\}$}]
                        [{$\{t\}$}]
                    ]
                ]
            \end{forest}        
            \begin{forest}    
                [{$\square$}
                    [{$\{\neg p\}$}
                        [{$\{\neg s\}$}]
                        [{$\{s,\neg p\}$}
                            [{$\{\neg t,s\}$}]
                            [{$\{t,\neg p\}$}]
                        ]
                    ]
                    [{$\{p\}$}]
                ]
            \end{forest}
            \begin{forest}    
                [{$\square$}    
                    [{$\{\neg r\}$}]
                    [{$\{r\}$}
                        [{$\{\neg p\}$}
                            [{$\{\neg s\}$}]
                            [{$\{s,\neg p\}$}
                                [{$\{\neg t,s\}$}]
                                [{$\{t,\neg p\}$}]
                            ]
                        ]
                        [{$\{p,r\}$}]
                    ]
                ]
            \end{forest}
            \begin{forest}
                [{$\square$}  
                    [{$\{\neg q\}$}]
                    [{$\{q\}$}    
                        [{$\{\neg r,q\}$}]
                        [{$\{r\}$}
                            [{$\{\neg p\}$}
                                [{$\{\neg s\}$}]
                                [{$\{s,\neg p\}$}
                                    [{$\{\neg t,s\}$}]
                                    [{$\{t,\neg p\}$}]
                                ]
                            ]
                            [{$\{p,r\}$}]
                        ]
                    ]                    
                ]
            \end{forest}
        
        \medskip

        Verify that the resulting tree indeed represents a resolution refutation of $S$. Notice how its shape mirrors the shape of the substitution tree. (In our case the tree is a “hairy path”, which need not be true in general, but the construction works the same way.)
                    
    \end{solution}
    
\end{problem}
        
        
\section*{Extra practice}
        

\begin{problem}
    
    Find a resolution refutation of the following formulas:
    \begin{enumerate}[(a)]
        \item $\neg(((p\to q)\to \neg q)\to \neg q)$
        \item $(p\leftrightarrow (q\to r))\wedge((p\leftrightarrow q)\wedge(p\leftrightarrow \neg r))$        
    \end{enumerate}
\end{problem}


\begin{problem}

    Tonia and Fabio describe to us their latest recipe for the best pizza in the world.
    \begin{itemize}
        \item Tonia said: ``The recipe includes anchovies or basil or garlic.''
        \item Tonia also said: ``If cooked ham is not included, then basil is not included either.''
        \item Fabio said: ``Cooked ham is included in the recipe.'' 
        \item Fabio further said: ``Neither anchovies nor basil are included, but garlic is included.''
    \end{itemize}
    We know that Tonia always tells the truth, while Fabio always lies.

    \begin{enumerate}[(a)]
        \item Express our knowledge as a propositional theory $T$ in the language $\mathbb P=\{a,b,c,d\}$, where the propositional variables mean (in order) ``anchovies / basil / garlic / cooked ham are included in the recipe''.
        \item Using the resolution method, prove that $T$ entails that ``anchovies are included in the recipe''. Draw the resolution tree.
    \end{enumerate}

\end{problem}


\begin{problem}

    The integers are afflicted by a mysterious disease spreading (in discrete steps) according to the following rules (valid for all integers at all time steps).
    \begin{enumerate}[(i)]\it
        \item A healthy number becomes ill exactly when precisely one neighboring number was ill (in the previous time).
        \item An ill number recovers exactly when the previous number was ill (in the previous time).
        \item At time $0$ the number $0$ was ill, all other numbers were healthy.
    \end{enumerate}
        %(By neighboring numbers of $i$ we mean $i-1$ and $i+1$, by the previous number we mean $i-1$.)
    \begin{enumerate}[(a)]
        \item Write theories $T_1, T_2, T_3$ expressing (respectively) statements (i), (ii), (iii) over the set of propositional atoms $\mathbb{P}=\{p_i^t \mid i\in\mathbb{Z}, t\in\mathbb{N}_0\}$, where the atom $p_i^t$ expresses that ``{\it number $i$ is ill at time $t$.}'' 
        \item Convert the axioms from $T_1, T_2, T_3$ to CNF and write a theory $S$ in set representation that is unsatisfiable exactly when $T_1 \cup T_2 \cup T_3 \models \neg p_1^2$, i.e. when ``{\it Number $1$ is healthy at time $2$.}'' (It is enough to convert only the specific axioms from $T_1,T_2,T_3$ that entail $\neg p_1^2$, and include only the corresponding clauses in $S$.)
        \item Prove by resolution that $S$ is unsatisfiable. Show the refutation as a resolution tree.
    \end{enumerate}

\end{problem}


        
\section*{For further thought}


\begin{problem}
    Prove in detail that if $S=\{C_1,C_2\}$ is satisfiable and $C$ is the resolvent of $C_1$ and $C_2$, then $C$ is satisfiable as well.
\end{problem}

