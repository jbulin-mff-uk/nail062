\section*{NAIL062 P\&P Logic: Worksheet 8 -- The tableau method in predicate logic}
% after Lecture 8


\subsection*{Teaching goals:} After completing, the student

  \begin{itemize}\setlength{\itemsep}{0pt}
        \item understands how the tableau method in predicate logic differs from propositional logic, can formally define all necessary concepts
        \item knows atomic tableaux for quantifiers, understands their use
        \item can construct a finished tableau for a given formula from a given (even infinite) theory
        \item can describe the canonical model for a given finished noncontradictory branch
        \item understands the axioms of equality, their relation to congruences, quotient structures
        \item can apply the tableau method to solve a given problem (word problem, etc.)
        \item understands tableau method for languages with equality, can apply to simple examples
        \item knows the compactness theorem of predicate logic, can apply it
    \end{itemize}

    

\section*{In-class problems}
        
       
\begin{problem}

    Assume that:
    \begin{itemize}\it
        \item All guilty people are liars.
        \item At least one of the accused is also a witness.
        \item No witness lies.
    \end{itemize}

    Prove by the tableau method that: {\it Not all the accused are guilty.} Specifically:
    \begin{enumerate}[(a)]
        \item Choose a suitable language $\mathcal L$. Will it be with equality, or without equality?        
        \item Formalize our knowledge and the statement to be proved as sentences $\alpha_1,\alpha_2,\alpha_3,\varphi$ in $\mathcal L$.
        \item Construct a tableau proof of the sentence $\varphi$ from the theory $T=\{\alpha_1,\alpha_2,\alpha_3\}$.
        %, i.e. the refutation tableau from theory $T$ with the item $\mathrm{F}\varphi$ at the root.
    \end{enumerate}

    \begin{solution}

        \begin{enumerate}[(a)]
            \item Let us choose the language $\mathcal L=\langle V,L,O,S\rangle$ without equality, where $V$, $L$, $O$ and $S$ are unary relation symbols meaning "to be a guilty person / a liar / an accused / a witness".
            \item 
            \begin{align*}
                \alpha_1 & = (\forall x)(V(x)\to L(x)) \\
                \alpha_2 & = (\exists x)(O(x)\land S(x)) \\
                \alpha_3 & = \neg(\exists x)(S(x)\land L(x)) \\
                \varphi & = \neg (\forall x)(O(x)\limplies V(x))
            \end{align*}
            \item We construct a finished tableau from the theory $T=\{\alpha_1,\alpha_2,\alpha_3\}$ with the item $F\varphi$ at the root. We will see that all branches are closed, so this is a tableau proof. (\textcolor{blue}{In blue} the attachment of axioms is marked, \textcolor{red}{in red} are the roots of atomic tableau entries of the "for all" type, which we could avoid drawing if our conventions allowed it.)
            
            \begin{center}
                \scalebox{1}{
                \begin{forest}
                    for tree={math content}
                    [\F\neg (\forall x)(O(x)\limplies V(x))
                        [\T (\forall x)(O(x)\limplies V(x))
                            [\textcolor{blue}{\T(\exists x)(O(x)\land S(x))}
                                [\T O(c_0)\land S(c_0)
                                    [\T O(c_0)
                                        [\T S(c_0)
                                            [\textcolor{red}{\T (\forall x)(O(x)\limplies V(x))}
                                                [\T O(c_0)\limplies V(c_0)
                                                    [\F O(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                    [\T V(c_0)
                                                        [\textcolor{blue}{\T(\forall x)(V(x)\limplies L(x))}
                                                            [\textcolor{red}{\T(\forall x)(V(x)\limplies L(x))}
                                                                [\T V(c_0)\limplies L(c_0)
                                                                    [\F V(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                                    [\T L(c_0)
                                                                        [\textcolor{blue}{\T\neg(\exists x)(S(x)\land L(x))}
                                                                            [\F(\exists x)(S(x)\land L(x))
                                                                                [\textcolor{red}{\F(\exists x)(S(x)\land L(x))}
                                                                                    [\F S(c_0)\land L(c_0)
                                                                                        [\F S(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]           [\F L(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                                                    ]
                                                                                ]
                                                                            ]
                                                                        ]
                                                                    ]
                                                                ]
                                                            ]
                                                        ]
                                                    ]       
                                                ]
                                            ]
                                        ]
                                    ]                                                
                                ]
                            ]
                        ]
                    ]
                \end{forest}
                }
            \end{center}            
        \end{enumerate}
                    
    \end{solution}

\end{problem} 
    

\begin{problem}

    Consider the following statements:
    \begin{enumerate}[(i)] \it 
        \item Zero is a small number.
        \item A number is small iff it is close to zero.
        \item The sum of two small numbers is a small number.
        \item If $x$ is close to $y$, then $f(x)$ is close to $f(y)$.
    \end{enumerate}

    We want to prove that: {\it (v) If $x$ and $y$ are small numbers, then $f(x+y)$ is close to $f(0)$.}

    \begin{enumerate}[(a)]
        \item Formalize the statements as sentences $\varphi_1,\dots,\varphi_5$ in $L=\langle M,B,f,+,0\rangle$ without equality.        
        \item Construct a finished tableau from the theory $T=\{\varphi_1,\varphi_2,\varphi_3,\varphi_4\}$ with the item $F\varphi_5$ at the root. Decide whether $T\models \varphi_5$.
        \item If they exist, give at least two complete simple extensions of the theory $T$.
    \end{enumerate}

    \begin{solution}

        \begin{enumerate}[(a)]
            \item \begin{align*}
                \varphi_1 & = M(0) \\
                \varphi_2 & = (\forall x)(M(x)\leftrightarrow B(x,0)) \\
                \varphi_3 & = (\forall x)(\forall y)(M(x)\wedge M(y)\to M(x+y)) \\
                \varphi_4 & = (\forall x)(\forall y)(B(x,y)\to B(f(x),f(y))) \\
                \varphi_5 & = (\forall x)(\forall y)(M(x)\wedge M(y)\to B(f(x+y),f(0)))
            \end{align*}

            \item The tableau is closed, so we have $T\proves \varphi_5$ and by completeness $T\models \varphi_5$. Note that the axiom $\varphi_1 = M(0)$ is not needed:
            
            \begin{center}
            \scalebox{0.95}{
            \begin{forest}
                for tree={math content}
                [{\F(\forall x)(\forall y)(M(x)\wedge M(y)\to B(f(x+y),f(0)))}
                  [{\F(\forall y)(M(c_0)\wedge M(y)\to B(f(c_0+y),f(0)))}
                    [{\F M(c_0)\wedge M(c_1)\to B(f(c_0+c_1),f(0))}
                      [\T M(c_0)\wedge M(c_1)
                        [{\F B(f(c_0+c_1),f(0))}
                          [\T M(c_0)
                            [\T M(c_1)
                              [\textcolor{blue}{\T(\forall x)(\forall y)(M(x)\wedge M(y)\to M(x+y))}
                                [\textcolor{red}{\T(\forall x)(\forall y)(M(x)\wedge M(y)\to M(x+y))}
                                  [\T(\forall y)(M(c_0)\wedge M(y)\to M(c_0+y))
                                    [\textcolor{red}{\T(\forall y)(M(c_0)\wedge M(y)\to M(c_0+y))}
                                      [\T M(c_0)\wedge M(c_1)\to M(c_0+c_1)
                                        [\F M(c_0)\wedge M(c_1)
                                          [\F M(c_0), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                          [\F M(c_1), tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                        ]
                                        [\T M(c_0+c_1)
                                          [\textcolor{blue}{\T(\forall x)(M(x)\leftrightarrow B(x,0))}
                                            [\textcolor{red}{\T(\forall x)(M(x)\leftrightarrow B(x,0))}
                                              [{\T M(c_0+c_1)\leftrightarrow B(c_0+c_1,0)}
                                                [\T M(c_0+c_1)
                                                  [{\T B(c_0+c_1,0)}
                                                    [\textcolor{blue}{\T (\forall x)(\forall y)(B(x,y)\to B(f(x),f(y)))}
                                                      [\textcolor{red}{\T (\forall x)(\forall y)(B(x,y)\to B(f(x),f(y)))}
                                                        [{\T (\forall y)(B(c_0+c_1,y)\to B(f(c_0+c_1),f(y)))}
                                                          [\textcolor{red}{\T (\forall y)(B(c_0+c_1,y)\to B(f(c_0+c_1),f(y)))}
                                                            [{\T B(c_0+c_1,0)\to B(f(c_0+c_1),f(0))}
                                                              [{\F B(c_0+c_1,0)}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                              [{\T B(f(c_0+c_1),f(0))}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                            ]
                                                          ]
                                                        ]
                                                      ]
                                                    ]
                                                  ]
                                                ]
                                                [\F M(c_0+c_1)
                                                  [{\F B(c_0+c_1,0)}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                ]
                                              ]
                                            ]
                                          ]
                                        ]
                                      ]
                                    ]
                                  ]
                                ]
                              ]                              
                            ]
                          ]
                        ]
                      ]
                    ]
                  ]
                ]
            \end{forest}
            }
            \end{center} 
            \item We find two elementarily non-equivalent models of $T$:
            \begin{itemize}
                \item $\mathcal A=\langle\{0\};M^\mathcal A,B^\mathcal A,f^\mathcal A,+^\mathcal A, 0^\mathcal A\rangle$ where $M^\mathcal A=\{0\}$, $B^\mathcal A=\{(0,0)\}$, $f^\mathcal A=\{(0,0)\}$, $+^\mathcal A=\{((0,0),0)\}$, and $0^\mathcal A=0$
                \item $\mathcal B=\langle\{0,1\};M^\mathcal B,B^\mathcal B,f^\mathcal B,+^\mathcal B, 0^\mathcal B\rangle$ where $M^\mathcal B=\{0\}$, $B^\mathcal B=\{(0,0),(1,1)\}$, $f^\mathcal B=\{(0,0),(1,1)\}$, $+^\mathcal B=\{((0,0),0),((0,1),1),((1,0),1),((1,1),0)\}$, and $0^\mathcal B=0$
            \end{itemize}
            The complete simple extensions are then $\mathrm{Th}(\mathcal A)$ and $\mathrm{Th}(\mathcal B)$ (i.e. all $L$-sentences true in $\mathcal A$ respectively $\mathcal B$). The theory of a structure is always a complete theory. They are not equivalent for example because $(\forall x)M(x)$ holds in $\mathcal A$ but not in $\mathcal B$. (Keep in mind that the language is without equality, so we need a sentence without equality.)
        \end{enumerate}
                    
    \end{solution}

\end{problem}


\begin{problem}

    Consider the language $L=\langle c\rangle$ with equality, where $c$ is a constant symbol. Using the tableau method prove that the formula $x=c$ is valid in $T=\{(\exists x)(\forall y)x=y\}$.

    \begin{solution}

        We construct a finished tableau from the theory $T$ with the item $\F(\forall x)x=c$ at the root (formulae in tableau items must be sentences). Since the language has equality, we may also use the equality axioms for the language $L$, or rather their universal closures: $(\forall x)x=x$ and $(\forall x_1)(\forall x_2)(\forall y_1)(\forall y_2)(x_1=y_1\wedge x_2=y_2\to (x_1=x_2\to y_1=y_2))$.

        \begin{center}
            \scalebox{0.95}{
            \begin{forest}
                for tree={math content}
                [{\F(\forall x)x=c}
                  [{\F c_0=c}
                    [\textcolor{blue}{\T(\exists x)(\forall y)x=y}
                      [{\T(\forall y)c_1=y}
                        [\textcolor{red}{\T(\forall y)c_1=y}
                          [{\T c_1=c}
                            [\textcolor{red}{\T(\forall y)c_1=y}
                              [{\T c_1=c_0}
                                [\textcolor{blue}{\T(\forall x_1)(\forall x_2)(\forall y_1)(\forall y_2)(x_1=y_1\wedge x_2=y_2\to (x_1=x_2\to y_1=y_2))}
                                  [\textcolor{red}{\T(\forall x_1)(\forall x_2)(\forall y_1)(\forall y_2)(x_1=y_1\wedge x_2=y_2\to (x_1=x_2\to y_1=y_2))}
                                    [{\T(\forall x_2)(\forall y_1)(\forall y_2)(c_1=y_1\wedge x_2=y_2\to (c_1=x_2\to y_1=y_2))}
                                      [\textcolor{red}{\T(\forall x_2)(\forall y_1)(\forall y_2)(c_1=y_1\wedge x_2=y_2\to (c_1=x_2\to y_1=y_2))}
                                        [{\T(\forall y_1)(\forall y_2)(c_1=y_1\wedge c_1=y_2\to (c_1=c_1\to y_1=y_2))}
                                          [\textcolor{red}{\T(\forall y_1)(\forall y_2)(c_1=y_1\wedge c_1=y_2\to (c_1=c_1\to y_1=y_2))}
                                            [{\T(\forall y_2)(c_1=c_0\wedge c_1=y_2\to (c_1=c_1\to c_0=y_2))}
                                              [\textcolor{red}{\T(\forall y_2)(c_1=c_0\wedge c_1=y_2\to (c_1=c_1\to c_0=y_2))}
                                                [{\T(c_1=c_0\wedge c_1=c\to (c_1=c_1\to c_0=c))}
                                                  [{\F c_1=c_0\wedge c_1=c}
                                                    [{\F c_1=c_0}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                    [{\F c_1=c}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                  ]
                                                  [{\T c_1=c_1\to c_0=c}
                                                    [{\F c_1=c_1}
                                                      [\textcolor{blue}{\T(\forall x)x=x}
                                                        [\textcolor{red}{\T(\forall x)x=x}
                                                          [{\T c_1=c_1
                                                          }, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                        ]    
                                                      ]
                                                    ]
                                                    [{\T c_0=c}, tikz={\node[fit to=tree,label=below:$\otimes$] {};}]
                                                  ]
                                                ]
                                              ]
                                            ]
                                          ]
                                        ]
                                      ]
                                    ]
                                  ]
                                ]
                              ]
                            ]
                          ]
                        ]
                      ]
                    ]
                  ]
                ]        
            \end{forest}
            }            
        \end{center}
                    
    \end{solution}

\end{problem}


\begin{problem} 
    
    Let $L$ be a language with equality containing a binary relational symbol $\le$ and let $T$ be an $L$-theory such that $T$ has an infinite model and the axioms of a linear order hold in $T$. Using the compactness theorem show that $T$ has a model $\mathcal{A}$ with an \emph{infinite descending chain}; that is, in $A$ there exist elements $c_i$ for every $i\in \mathbb{N}$ such that: $\dots < c_{n+1} < c_n< \dots <c_0$.
    (This implies that the notion of a \emph{well-ordering} is not definable in first-order logic.)

    \begin{solution}

        From the assumption we know that $T$ has an infinite model $\mathcal B$, i.e. an infinite linear order. This could, however, be for example $\langle \mathbb N;\leq^\mathbb N\rangle$, which has no infinite descending chain. We need a model with an infinite descending chain; we obtain it from the Compactness Theorem (version for predicate logic):
                
        Expand the language $L$ by adding countably many new constant symbols $c_i$ ($i\in\mathbb{N}$). Denote the expanded language by $L'$. Consider the following $L'$-theory $T'$:
        $$
        T' = T \cup \{c_{i+1}\leq c_i\land\neg c_{i+1}=c_i\mid i\in\mathbb{N}\}
        $$
        It is enough to show that $T'$ has a model. Such a model must obviously be infinite and its reduct to the language $L$ is the desired model $\mathcal A$ of the theory $T$ which has an infinite descending chain $\dots < c_{n+1}^\mathcal A < c_n^\mathcal A < \dots < c_0^\mathcal A$. 
        
        By the compactness theorem we know that $T'$ has a model iff every finite subset of $T'$ has a model. If we take a finite subtheory $S\subseteq T'$, it contains only finitely many formulas $c_{i+1}\leq c_i\land\neg c_{i+1}=c_i$, for some finite set of indices $I\subseteq\mathbb N$. Let $\mathcal B$ be the infinite model of $T$ from the assumption. (This model need not have an infinite descending chain! It might be for example $\langle \mathbb N;\leq^\mathbb N\rangle$.) In it we can choose any finite descending chain of length $|I|$ to interpret the constant symbols $c_i$ for $i\in I$ (interpret the symbols $c_j\notin I$ arbitrarily), and thus obtain a model of $S$.
                    
    \end{solution}

\end{problem}


\section*{Extra practice}


\begin{problem}
    
    Consider the following statements:
    \begin{enumerate}[(i)]\it
        \item Every professor has written at least one textbook.
        \item Every textbook was written by some professor.
        \item For every professor, someone is studying with them.
        \item Everyone who studies with some professor has read all textbooks by that professor.
        \item Every textbook has been read by someone.
    \end{enumerate}    
    \begin{enumerate}[(a)]
        \item Formalize {\it(i)--(v)} as sentences $\varphi_1,\varphi_2,\varphi_3,\varphi_4,\varphi_5$ in $L=\langle N, S, P, D, U\rangle$ without equality.
        %, where $N,S,P$ are binary relation symbols ($N(x,y)$ means ``$x$ wrote $y$'', $S(x,y)$ means ``$x$ studies with $y$'', $P(x,y)$ means ``$x$ read $y$'') and $D,U$ are unary relation symbols (``being an professor'', ``being a textbook'').
        \item Construct a finished tableau from $T=\{\varphi_1,\varphi_2,\varphi_3,\varphi_4\}$ with item $F\varphi_5$ at the root.
        \item Is the sentence $\varphi_5$ true in the theory $T$? Is it false in $T$? Is it independent in $T$? Justify.
        \item Does the theory $T$ have a complete conservative extension? Justify.
        %\item How many 2-element models (up to isomorphism) does $T'=T\cup \{D(x),S(x,y),P(x,y)\}$ have?
    \end{enumerate}

\end{problem}


\begin{problem}
    
    Using the tableau method, prove the following rules for `pulling out' quantifiers, where $\varphi(x)$ is a formula with a single free variable $x$, and $\psi$ is a sentence.

    \vspace{-6pt}
    \begin{multicols}{2}
        \begin{enumerate}[(a)]        
            \item $\neg(\exists x)\varphi(x)\to (\forall x)\neg \varphi(x)$
            \item $(\forall x)\neg \varphi(x)\to \neg(\exists x)\varphi(x)$
            \item $((\exists x)\varphi(x)\to\psi)\to(\forall x)(\varphi(x)\to \psi)$       
            \item $(\forall x)(\varphi(x)\to\psi)\to((\exists x)\varphi(x)\to \psi)$            
        \end{enumerate}
    \end{multicols}
    \vspace{-6pt}
    
\end{problem}


\begin{problem} 
    
    Let $L(x,y)$ represent \emph{``there is a flight from $x$ to $y$''} and $S(x,y)$ represent \emph{``there is a connection from $x$ to $y$''}. Assume that from Prague one can fly to Bratislava, London, and New York, and from New York to Paris, and that
    \begin{itemize}  
        \item $(\forall x)(\forall y)(L(x,y) \to L(y,x))$,
        \item $(\forall x)(\forall y)(L(x,y)\to S(x,y))$,
        \item $(\forall x)(\forall y)(\forall z)(S(x,y)\wedge L(y,z)\to S(x,z))$.
    \end{itemize}
    Prove using the tableau method that there is a connection from Bratislava to Paris.

\end{problem}



\begin{problem} 

    Let $T$ be the following theory in the language $L=\langle R,f,c,d\rangle$ with equality, where $R$ is a binary relation symbol, $f$ a unary function symbol, and $c,d$ constant symbols:
    $$
    T=\{R(x,x),R(x,y)\wedge R(y,z)\to R(x,z),R(x,y)\wedge R(y,x)\to x=y,R(f(x),x)\}
    $$
    Denote by $T'$ the general closure of $T$. Let $\varphi$ and $\psi$ be the following formulas:
    $$
    \varphi = R(c,d) \wedge (\forall x)(x=c\vee x=d)\qquad\qquad
    \psi = (\exists x)R(x,f(x))
    $$
    \begin{enumerate}[(a)]
        \item Construct a tableau proof of $\psi$ from $T'\cup\{\varphi\}$. (For simplicity, in the tableau you may directly use the axiom $(\forall x)(\forall y)(x=y\to y=x)$, a consequence of the equality axioms.)
        \item Show that $\psi$ is not a consequence of $T$ by finding a model of $T$ in which $\psi$ is not valid.
        \item How many complete simple extensions (up to $\sim$) does $T\cup \{\varphi\}$ have? Provide two examples.
        \item Is the following theory $S$ in $L'=\langle R\rangle$ with equality a conservative extension of $T$?
        $$S=\{R(x,x),R(x,y)\wedge R(y,z)\to R(x,z),R(x,y)\wedge R(y,x)\to x=y\}$$     
    \end{enumerate}

\end{problem}


\section*{For further thought}


\begin{problem} 
    
    Prove syntactically, using tableau transformations:
    \begin{enumerate}[(a)]
        \item \emph{Theorem on Constants}: Let $\varphi$ be a formula in the language $L$ with free variables $x_1,\dots,x_n$ and $T$ a theory in $L$. Let $L'$ be the extension of $L$ with new constant symbols $c_1,\dots,c_n$ and $T'$ the theory $T$ in $L'$. Then:
        $T \vdash (\forall x_1)\dots(\forall x_n)\varphi$ if and only if $T'\vdash\varphi(x_1/c_1,\dots,x_n/c_n)$
        \item \emph{Deduction Theorem}: For any theory $T$ (in closed form) and sentences $\varphi$, $\psi$, we have: $T\vdash \varphi\to\psi$ if and only if $T,\varphi\vdash\psi$
    \end{enumerate}

\end{problem}


\begin{problem} 
    
    Let $T^*$ be a theory with equality axioms. Show using the tableau method that:
    \begin{enumerate}[(a)]
        \item $T^*\models x=y\ \to\ y=x$\hfill(symmetry)
        \item $T^*\models (x=y\ \wedge\ y=z)\ \to\ x=z$\hfill(transitivity)
    \end{enumerate}
    {\it Hint:} For (a) use the equality axiom $(iii)$ for $x_1=x$, $x_2=x$, $y_1=y$ and $y_2=x$, \newline
        for (b) use $(iii)$ for $x_1=x$, $x_2=y$, $y_1=x$ and $y_2=z$.
        
\end{problem}

  



