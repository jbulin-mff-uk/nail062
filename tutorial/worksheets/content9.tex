\section*{NAIL062 P\&P Logic: Worksheet 9 -- Prep for resolution in predicate logic}
% after Lecture 9


\subsection*{Teaching goals:} After completing, the student

    \begin{itemize}\setlength{\itemsep}{0pt}
        \item can convert formulas into prenex normal form (PNF)
        \item understands the notion of a Skolem variant, can Skolemize a given theory
        \item can transform a given open theory into CNF, write it in set representation
        \item knows Herbrand's theorem, can demonstrate it on an example, describe a Herbrand model
    \end{itemize}

    

\section*{In-class problems}


\begin{problem} 
    
    Convert the following formulas into PNF. Then find their Skolem variants.
    \begin{enumerate}[(a)]
        \item $(\forall y)((\exists x)P(x,y)\to Q(y,z))\wedge (\exists y)((\forall x)R(x,y)\vee Q(x,y))$
        \item $(\exists x)R(x,y)\leftrightarrow (\forall y)P(x,y)$
        \item $\neg((\forall x)(\exists y)P(x,y)\to (\exists x)(\exists y)R(x,y))\wedge(\forall x)\neg(\exists y)Q(x,y)$
    \end{enumerate}

    \begin{solution}

        \begin{enumerate}[(a)]
            \item Free variables are $x,z$. (You may draw the formula tree.) First, rename bound variables to be distinct and different from free variables. We get the equivalent formula:
            $$
            (\forall y_1)((\exists x_1)P(x_1,y_1)\to Q(y_1,z))\wedge (\exists y_2)((\forall x_2)R(x_2,y_2)\vee Q(x,y_2))
            $$
            Then apply rules to convert into PNF by moving quantifiers up according to the formula tree. The order of pulling out quantifiers is chosen so that existential quantifiers come first in the prefix, followed by universal ones. We get:
            \begin{align*}
                &(\forall y_1)((\exists x_1)P(x_1,y_1)\to Q(y_1,z))\wedge (\exists y_2)((\forall x_2)R(x_2,y_2)\vee Q(x,y_2))\\
                \sim\ & (\forall y_1)(\forall x_1)(P(x_1,y_1)\to Q(y_1,z))\wedge (\exists y_2)(\forall x_2)(R(x_2,y_2)\vee Q(x,y_2))\\
                \sim\ & (\exists y_2)((\forall y_1)(\forall x_1)(P(x_1,y_1)\to Q(y_1,z))\wedge (\forall x_2)(R(x_2,y_2)\vee Q(x,y_2)))\\
                \sim\ & (\exists y_2)(\forall y_1)(\forall x_1)(\forall x_2)((P(x_1,y_1)\to Q(y_1,z))\wedge (R(x_2,y_2)\vee Q(x,y_2)))
            \end{align*}
            For Skolemization, take the sentence (general closure):
            $$
            (\forall x)(\forall z)(\exists y_2)(\forall y_1)(\forall x_1)(\forall x_2)((P(x_1,y_1)\to Q(y_1,z))\wedge (R(x_2,y_2)\vee Q(x,y_2)))
            $$
            Skolem variant:
            $$
            (\forall x)(\forall z)(\forall y_1)(\forall x_1)(\forall x_2)((P(x_1,y_1)\to Q(y_1,z))\wedge (R(x_2,f(x,z))\vee Q(x,f(x,z))))
            $$
            where $f$ is a new binary function symbol.
            
            \item Proceed similarly, rewriting equivalence as two implications first:
            \begin{align*}
                &(\exists x)R(x,y)\leftrightarrow (\forall y)P(x,y)\\
                \sim\ &((\exists x)R(x,y)\to (\forall y)P(x,y))\land((\forall y)P(x,y)\to (\exists x)R(x,y))\\
                \sim\ &(\exists x_2)(\exists y_2)(\forall x_1)(\forall y_1)((R(x_1,y)\to P(x,y_1))\land(P(x,y_2)\to R(x_2,y)))\\
                \sim\ &(\forall x)(\forall y)(\exists x_2)(\exists y_2)(\forall x_1)(\forall y_1)((R(x_1,y)\to P(x,y_1))\land(P(x,y_2)\to R(x_2,y)))
            \end{align*}
            Skolem variant ($f,g$ new binary function symbols):
            $$
            (\forall x)(\forall y)(\forall x_1)(\forall y_1)((R(x_1,y)\to P(x,y_1))\land(P(x,g(x,y))\to R(f(x,y),y)))
            $$

            \item The formula is already a sentence. Similarly:
            \begin{align*}
            &\neg((\forall x)(\exists y)P(x,y)\to (\exists x)(\exists y)R(x,y))\wedge(\forall x)\neg(\exists y)Q(x,y)\\
            \sim\ & (\forall x)(\exists y)(\forall x')(\forall y')(\forall x'')(\forall y'')
            (    
                \neg(P(x,y)\to R(x',y'))\wedge\neg Q(x'',y'') 
            )
            \end{align*}
            
        \end{enumerate}
                    
    \end{solution}

\end{problem}


\begin{problem} 
    
    Convert into an equisatisfiable CNF formula, written in set representation.

    \begin{enumerate}[(a)]
        \item $(\forall y)(\exists x)P(x,y)$
        \item $\neg (\forall y)(\exists x)P(x,y)$
        \item $\neg (\exists x)((P(x)\to P(c))\wedge (P(x)\to P(d)))$
        \item $(\exists x)(\forall y)(\exists z)(P(x,z)\wedge P(z,y) \to R(x,y))$
    \end{enumerate}

    \begin{solution}
        First, create the Skolem variant, then take the open core and convert to CNF using equivalent transformations:
        \begin{enumerate}[(a)]
            \item Skolem variant: $(\forall y)(P(f(y),y))$, open core: $P(f(y),y)$, CNF set representation: 
            $$
            S=\{\{P(f(y),y)\}\}
            $$
            \item $\neg (\forall y)(\exists x)P(x,y)\sim(\exists y)(\forall x)\neg P(x,y)$, Skolem variant: $(\forall x)\neg P(x,c)$, CNF: $S=\{\{\neg P(x,c)\}\}$
            \item Already a sentence. PNF: $(\forall x)\neg((P(x)\to P(c))\wedge (P(x)\to P(d)))$, CNF: $S=\{\{P(x)\},\{\neg P(c),\neg P(d)\}\}$
            \item Skolem variant: $(\forall y)(P(c,f(y))\wedge P(f(y),y) \to R(c,y))$, CNF: $S=\{\{\neg P(c,f(y)),\neg P(f(y),y), R(c,y)\}\}$
        \end{enumerate}
    \end{solution}

\end{problem}


\begin{problem}
    
    Let $T=\{(\exists x)R(x), (\exists y)\neg P(x,y), (\exists y)(\forall z)(\neg R(x)\vee P(y,z))\}$ be a theory in the language $L=\langle P,R\rangle$ without equality. Find an open theory $T'$ equisatisfiable with $T$. Convert $T'$ into CNF and write the resulting formula $S$ in set representation.

    \begin{solution}
        Take general closures:
        $T\sim\{(\exists x)R(x), (\forall x)(\exists y)\neg P(x,y), (\forall x)(\exists y)(\forall z)(\neg R(x)\vee P(y,z))\}$. Skolemize with new symbols:
        $$\{R(c), (\forall x)\neg P(x,f(x)), (\forall x)(\forall z)(\neg R(x)\vee P(g(y),z))\}$$
        Remove universal quantifiers:
        $$T'=\{R(c), \neg P(x,f(x)), \neg R(x)\vee P(g(y),z)\}$$
        CNF set representation:
        $$S=\{\{R(c)\},\{\neg P(x,f(x))\},\{\neg R(x),P(g(y),z)\}\}$$
        
        $S$ is unsatisfiable: substitute into the second and third clauses to get:
        $$
        S'=\{\{R(c)\},\{\neg P(g(c),f(g(c)))\},\{\neg R(c),P(g(c),f(g(c)))\}\}
        $$
        By equisatisfiability, the original theory $T$ is also unsatisfiable.        
    \end{solution}

\end{problem}


\begin{problem}

    Let $T=\{\varphi_1,\varphi_2\}$ be a theory in the language $L=\langle R\rangle$ with equality:
    \begin{align*}
    \varphi_1=&\quad (\exists y)R(y,x)\\
    \varphi_2=&\quad (\exists z)(R(z,x)\wedge R(z,y)\wedge (\forall w)(R(w,x) \wedge R(w,y)\to R(w,z)))
    \end{align*}
    \begin{enumerate}[(a)]
        \item Using Skolemization, construct an open axiomatized theory $T'$ equisatisfiable with $T$ (possibly in an extended language $L'$).
        \item Let $\mathcal{A}=\langle\mathbb{N},R^A\rangle$, where $(n,m)\in R^A$ iff $n$ divides $m$. Find an expansion $\mathcal{A}'$ of $\mathcal{A}$ to $L'$ such that $\mathcal{A}'\models T'$.
    \end{enumerate}

    \begin{solution}
        \begin{enumerate}[(a)]
            \item Skolemization:
            \begin{itemize}
                \item $\varphi_1\sim (\forall x)(\exists y)R(y,x)$, Skolem variant: $(\forall x)R(f(x),x)$
                \item $\varphi_2\sim (\forall x)(\forall y)(\exists z)(\forall w)(R(z,x)\wedge R(z,y)\wedge (R(w,x) \wedge R(w,y)\to R(w,z)))$, Skolem variant: $(\forall x)(\forall y)(\forall w)(R(g(x,y),x)\wedge R(g(x,y),y)\wedge (R(w,x) \wedge R(w,y)\to R(w,g(x,y))))$
            \end{itemize}
            Remove quantifier prefixes:
            $$
            T'=\{R(f(x),x), R(g(x,y),x), R(g(x,y),y), R(w,x) \wedge R(w,y)\to R(w,g(x,y))\}
            $$
            \item Interpretation: $f$ and $g$ correspond to divisors and greatest common divisors:
            \begin{itemize}
                \item $f^{\mathcal A'}(n)=n$ (or $1$)
                \item $g^{\mathcal A'}(n,m)=\gcd(n,m)$
            \end{itemize}
            So $\mathcal A'=\langle\mathbb N,R^\mathcal A,f^{\mathcal A'},g^{\mathcal A'}\rangle$ satisfies $T'$. This is one possible expansion; Skolemization ensures equisatisfiability but not uniqueness.
        \end{enumerate}
    \end{solution}

\end{problem}


\begin{problem} 
    
    Construct a Herbrand model for the given theory, or find an unsatisfiable conjunction of ground instances (where $c,d$ are constants in the language).    
    \begin{enumerate}[(a)]
        \item $T=\{\neg P(x)\vee Q(f(x),y), \neg Q(x,d), P(c)\}$
        \item $T=\{\neg P(x)\vee Q(f(x),y), Q(x,d), P(c)\}$
        \item $T=\{P(x,f(x)),\neg P(x,g(x))\}$
        \item $T=\{P(x,f(x)),\neg P(x,g(x)), P(g(x),f(y)) \to P(x,y)\}$
    \end{enumerate}

    \begin{solution}
        \begin{enumerate}[(a)]
            \item $T$ is inconsistent. Unsatisfiable conjunction of ground instances:
            $$
            (\neg P(c)\lor Q(f(c),d))\land \neg Q(f(c),d)\land P(c)
            $$
            Treat atoms as propositional variables: $P(c)=p$, $Q(f(c),d)=q$, giving $(\neg p\lor q)\land \neg q\land p$.
            \item $T$ is satisfiable; a Herbrand model can be constructed with universe of all constant terms and function application terms, e.g., $P^\mathcal H=H$, $Q^\mathcal H=H\times H$, $f^\mathcal H(t)=f(t)$.
            \item $T$ is satisfiable; for example, choose $P^\mathcal H=H\times\{f(t)\mid t\in H\}$.
            \item $T$ is inconsistent. Introduce a constant $c$ if needed. Unsatisfiable conjunction of ground instances:
            $$
            P(g(c),f(g(c)))\land \neg P(c,g(c))\land (P(g(c),f(g(c))) \to P(c,g(c)))
            $$
        \end{enumerate}

    \end{solution}

\end{problem}


        
\section*{Extra practice}


\begin{problem}

    The theory of fields $T$ in the language $L=\langle +,-,\cdot,0,1\rangle$ contains a single axiom $\varphi$, which is not open: $x\neq 0\ \to\ (\exists y)(x\cdot y=1)$. We know that $T\models 0\cdot y=0$ and $T\models\ (x\ne 0\ \wedge\ x\cdot y=1\ \wedge\ x\cdot z=1)\ \to\ y=z$.
    \begin{enumerate}[(a)]
        \item Find the Skolem form $\varphi_S$ of the formula $\varphi$ with a new function symbol $f$.
        \item Consider the theory $T'$ obtained from $T$ by replacing $\varphi$ with $\varphi_S$. Is $\varphi$ valid in $T'$?
        \item Can every model of $T$ be \emph{uniquely} extended to a model of $T'$?
    \end{enumerate}
    Now consider the formula $\psi=x\cdot y=1\vee  (x=0 \wedge y=0)$.
    \begin{enumerate}[(a)]
        \setcounter{enumi}{3}
        \item Are the axioms of existence and uniqueness valid in $T$ for $\psi(x,y)$ and the variable $y$?
        \item Construct an extension $T''$ of the theory $T$ by defining a symbol $f$ using the formula $\psi$.
        \item Is $T''$ equivalent to the theory $T'$?
        \item Find an $L$-formula that is $T''$-equivalent to the formula:
        $f(x\cdot y)=f(x)\cdot f(y)$
    \end{enumerate}

\end{problem}


\medskip\begin{problem} We know the following holds:
    \begin{itemize}\it
        \item If a brick is on (another) brick, then it is not on the ground.
        \item Every brick is on (another) brick or on the ground.
        \item No brick is on a brick that is on (another) brick.
    \end{itemize}
    We want to prove by resolution the following statement: {\it ``If a brick is on (another) brick, the lower brick is on the ground.''}. Construct the corresponding CNF formula $S$, and try to also find its resolution refutation.
\end{problem}

        
\section*{For further thought}

    
\begin{problem}
    
    The Skolem form does not have to be equivalent to the original formula; verify that the following holds:
    \begin{enumerate}[(a)]
        \item $\models (\forall x)P(x,f(x)) \to (\forall x)(\exists y)P(x,y)$
        \item $\not\models (\forall x)(\exists y)P(x,y)\to (\forall x)P(x,f(x))$
    \end{enumerate}

\end{problem}
















 


